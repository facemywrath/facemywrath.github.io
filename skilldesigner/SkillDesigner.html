<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skill Designer</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f4f4f4; }
    label, select, input { margin: 0.2em; }
    .effect-block, .scaling-entry { background: #fff; border: 1px solid #ccc; padding: 1em; margin-top: 1em; }
    .effect-block h4 { margin-top: 0; }
    .scaling-entry { margin-top: 0.5em; padding: 0.5em; }
    .controls { margin-top: 0.5em; }
  </style>
</head>
<body>

<h2>Skill Designer</h2>

<label>Name: <input id="skillName"></label>

<h3>Cost</h3>
<label>HP: <input id="hpCost" type="number" value="0"></label><br>
<label>MP: <input id="mpCost" type="number" value="0"></label><br>
<label>SP: <input id="spCost" type="number" value="0"></label><br>

<label>Target:
  <select id="skillTarget">
    <option>singleEnemy</option><option>singleAlly</option><option>randomEnemy</option><option>randomAlly</option>
    <option>random</option><option>allAllies</option><option>allEnemies</option><option>all</option><option>adjacent</option>
  </select>
</label><br></br>
<label>Requires Target?
  <select id="requiresTarget">
    <option value="true">true</option>
    <option value="false">false</option>
  </select>
</label>

<h3>Cooldown</h3>
<label>Base: <input id="cooldownBase" type="number"></label>
<div id="cooldownScalings"></div>
<button onclick="addScaling('cooldownScalings')">+ Add Cooldown Scaling</button>

<h3>Effects</h3>
<div id="effectsArea"></div>
<button onclick="addEffect()">+ Add Effect</button>

<div class="controls">
  <button onclick="generateSkill()">Generate Skill JSON</button>
</div>
<button onclick="copyOutput()">Copy to Clipboard</button>
<pre id="output"></pre>

<script>
const attributes = ["strength", "dexterity", "constitution", "intellect", "wisdom", "willpower"];
const allStats = [
  "hp", "mp", "sp", "attackPower", "spellPower", "cooldownReduction",
  "strength", "intellect", "dexterity", "wisdom", "willpower", "constitution", "skillLevel"
];
const statOptions = [...attributes, ...allStats, "skillLevel"];
const effectTargets = [
  "", "singleEnemy", "singleAlly", "randomEnemy", "randomAlly",
  "random", "allAllies", "allEnemies", "all", "adjacent"
];
const effectTypes = ["damage", "interrupt", "siphon", "heal", "buff", "debuff", "condition", "summon"];
const conditionTypes = ["Burning", "Stunned", "Corruption"];
const statSources = ["attribute", "stat"];
const damageTypes = ["heat", "cold", "shock", "blight", "arcane", "void", "holy", "corrupt", "physical", "magic"];

function addScaling(containerId) {
  const div = document.createElement("div");
  div.className = "scaling-entry";
  div.innerHTML = `
    <select><option>caster</option><option>target</option></select>
    <input type="number" placeholder="scale" step="0.01">
    <select>${statOptions.map(s => `<option>${s}</option>`).join("")}</select>
    <button onclick="this.parentElement.remove()">−</button>
  `;
  document.getElementById(containerId).appendChild(div);
}
function copyOutput() {
  const output = document.getElementById("output").textContent;
  navigator.clipboard.writeText(output).then(() => {
    alert("Copied to clipboard!");
  }).catch(err => {
    console.error("Failed to copy:", err);
  });
}
function addEffect() {
  const effectDiv = document.createElement("div");
  effectDiv.className = "effect-block"
  

  const effectId = `effect_${document.querySelectorAll('.effect-block').length}`;
  effectDiv.id = effectId;
  effectDiv.innerHTML = `
    <h4>Effect</h4>
    <label>Type:
      <select onchange="renderEffectFields(this, '${effectId}')">
        ${effectTypes.map(t => `<option>${t}</option>`).join("")}
      </select>
    </label><br>
    <label>Target:
      <select>
        ${effectTargets.map(t => `<option value="${t}">${t || "None"}</option>`).join("")}
      </select>
    </label>
    <div id="${effectId}_fields"></div>
    <div id="${effectId}_scalings"></div>
    <button onclick="addScaling('${effectId}_scalings')">+ Add Scaling</button>
    <div class="controls">
      <button onclick="this.closest('.effect-block').remove()">− Remove Effect</button>
    </div>
  `;
  document.getElementById("effectsArea").appendChild(effectDiv);
  renderEffectFields(effectDiv.querySelector("select"), effectId);
}

function renderEffectFields(select, id) {
  const type = select.value;
  const container = document.getElementById(`${id}_fields`);
  container.innerHTML = "";

  if (["damage", "interrupt", "siphon", "buff", "debuff", "heal"].includes(type)) {
    if (type === "damage") {
      container.innerHTML += `
        <label>Damage Type:
          <select>${damageTypes.map(t => `<option>${t}</option>`).join("")}</select>
        </label><br>`;
    }
    if (["siphon", "buff", "debuff"].includes(type)) {
      container.innerHTML += `
        <label>Stat Type:
          <select>${statSources.map(s => `<option>${s}</option>`).join("")}</select>
        </label><br>
        <label>Stat:
          <select>${statOptions.map(s => `<option>${s}</option>`).join("")}</select>
        </label><br>
        <label>Duration: <input type="number">
        </label><br>`;
    }
    container.innerHTML += `<label>Base: <input type="number"></label>`;
  }

  if (type === "condition") {
    container.innerHTML = `
      <label>Name:
        <select onchange="this.nextElementSibling.style.display = (this.value === 'Stunned') ? 'block' : 'none'">
          ${conditionTypes.map(n => `<option>${n}</option>`).join("")}
        </select>
      </label><br>
      <label style="display:none">Duration: <input type="number"></label><br>
      <label>Stacks: <input type="number" value="1"></label>
    `;
  }
  if (type === "summon") {
    container.innerHTML = `
      <label>Unit Name: <input type="string">
      </label><br>
      <label>isAlly <select id="isAlly">
    <option value="true">true</option>
    <option value="false">false</option>
  </select></label><br>
      <label>Tier: <input type="number" value="1"></label>
    `;
  }
}

function generateSkill() {
  const skill = {
    name: document.getElementById("skillName").value,
    cost: (() => {
      const cost = {};
      const hp = parseInt(document.getElementById("hpCost").value || "0");
      const mp = parseInt(document.getElementById("mpCost").value || "0");
      const sp = parseInt(document.getElementById("spCost").value || "0");
      if (hp) cost.hp = hp;
      if (mp) cost.mp = mp;
      if (sp) cost.sp = sp;
      return cost;
    })(),
    target: document.getElementById("skillTarget").value,
    requiresTarget: document.getElementById("requiresTarget").value === "true",
    cooldown: {
      base: parseFloat(document.getElementById("cooldownBase").value || "0"),
      scaling: []
    },
    effects: []
  };

  // Cooldown scalings
  document.querySelectorAll("#cooldownScalings .scaling-entry").forEach(entry => {
    const [targetSel, scaleInput, statSel] = entry.querySelectorAll("select, input, select:nth-of-type(2)");
    skill.cooldown.scaling.push({
      target: targetSel.value,
      scale: parseFloat(scaleInput.value),
      stat: statSel.value
    });
  });

  // Effects
  document.querySelectorAll(".effect-block").forEach(block => {
    const effect = {};
    const selects = block.querySelectorAll("select");
    const inputs = block.querySelectorAll("input");
    const type = selects[0].value;
    const target = selects[1].value;
    effect.type = type;
    if (target) effect.target = target;

    const scalingArray = [];
    block.querySelectorAll(".scaling-entry").forEach(s => {
      const [targetSel, scaleInput, statSel] = s.querySelectorAll("select, input, select:nth-of-type(2)");
      scalingArray.push({
        target: targetSel.value,
        scale: parseFloat(scaleInput.value),
        stat: statSel.value
      });
    });

    const fields = block.querySelector(`#${block.id}_fields`);
    const fselects = fields.querySelectorAll("select");
    const finputs = fields.querySelectorAll("input");

    if (["damage", "interrupt", "siphon", "buff", "debuff", "heal", "summon"].includes(type)) {
      if (["siphon", "buff", "debuff"].includes(type)) {
        effect.statType = fselects[0].value;
        effect.stat = fselects[1].value;
        effect.base = parseFloat(finputs[0].value);
      } else if (type === "damage") {
        effect.damageType = fselects[0].value;
        effect.base = parseFloat(finputs[0].value);
      } else if(type == "summon"){
        effect.unit = finputs[0].value;
        effect.tier = finputs[1].value;
        effect.isAlly = fselects[0].value;
      } else {
        effect.base = parseFloat(finputs[0].value);
      }
      if (scalingArray.length) effect.scaling = scalingArray;
    } else if (type === "condition") {
      effect.name = fselects[0].value;
      effect.stacks = parseInt(finputs[1].value || "1");
      if (effect.name === "Stunned") {
        effect.duration = parseInt(finputs[0].value);
      }
    }

    skill.effects.push(effect);
  });

  const output = {};
output[toCamelCase(skill.name)] = skill;
document.getElementById("output").textContent = JSON.stringify(output, null, 2);
}
function toCamelCase(str) {
  return str
    .toLowerCase()
    .replace(/[^a-zA-Z0-9]+(.)/g, (_, chr) => chr.toUpperCase());
}
</script>

</body>
</html>
